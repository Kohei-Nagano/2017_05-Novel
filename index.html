<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <title>Novel_9</title>
        <link rel="stylesheet" type="text/css" href="css/style.css">

        <script src="js/novel/novel.js"></script>
        <script src="js/game/common.js"></script>
        <script src="js/game/main.js"></script>
        <script src="js/game/player.js"></script>
        <script src="js/game/enemy.js"></script>
        <script src="js/game/bullet.js"></script>

    </head>
    <body>
        <div id="nowloading">
        	<div id="nowloading-info">
		        <img src="image/loading.gif">
            </div>
        </div>
        <div id="titleScreen">
            <div id="title"></div>
        </div>
        <div id="mainScreen">
            <div id="serif_bg"></div>
            <div id="serif"></div>
            <div id="chara"></div>
            <div id="item"></div>  
        </div>
        <div id="gameScreen" oncontextmenu="return false;">
            <canvas id="screen"></canvas>
            <p id="info"></p>
        </div>

        <audio id="defBGM" src="sound/BGM/BGM01.mp3" auto></audio>
        <audio id="clefable" src="sound/se/036.wav" auto></audio>
        <audio id="gastly" src="sound/se/092.wav" auto></audio>
        <audio id="haunter" src="sound/se/093.wav" auto></audio>
        <audio id="gengar" src="sound/se/094.wav" auto></audio>
        <audio id="mewtwo" src="sound/se/150.wav" auto></audio>
        <audio id="shine" src="sound/se/shine.mp3" auto></audio>
        <audio id="shadow" src="sound/se/shadow.mp3" auto></audio>
        <audio id="comet" src="sound/se/comet.mp3" auto></audio>
        <audio id="game_bgm" src="sound/se/comet.mp3" auto></audio>

        <script src="js/jquery.min.js"></script>
        <script>
            var novel = new Novel();

            $(document).ready(function(){

                var assets = [
                      "image/chara/pippi_01.png"
                    , "image/chara/gastly.png"
                    , "image/chara/haunter.png"
                    , "image/chara/gengar.png"
                    , "image/chara/stone1.png"
                    , "image/chara/stone2.png"
                    , "image/selif_bg.png"
                    , "image/title.png"
                    , "image/bg/BG003.png"
                    , "image/bg/BG004.png"
                    , "image/bg/BG005.png"
                    , "image/bg/BG006.jpg"
                    , "image/bg/BG007.jpg"
                    , "image/game/player.png"
                    , "image/game/shine.png"
                    , "image/game/shadow_ball.png"
                    , "image/game/punch.png"
                    , "image/game/enemy1.png"
                    , "image/game/enemy2.png"
                    , "image/game/game_back.jpg"
                ];


                var callback = function(img){
                    //裏側で画像一覧作成
                    var result="";
                    for(i=0; i<img.length; i++){
                        result += "<li><img src=\""+ img[i].src +"\"></li>";
                    }
                
                    var defBGM = new Audio("sound/bgm/BGM01.mp3");
                        $(defBGM).on("canplaythrough", function(){
                            $("#nowloading").hide();
                            $("#titleScreen").show();

                             $("#defBGM").get(0).loop = true;
                             $("#defBGM").get(0).play();
                            //あらーと
                            alert("読み込みが完了しました！");
                        });

                    
                };

                //プリロード＆完了後の処理
                IMGLoader(assets, callback);

                $("#titleScreen").on("click", function(){
                    $("#titleScreen").hide();
                    novel.init();
                });
                $("#serif").on("click", function(){
                    novel.play();
                });
            });

            /**
             * 画像プリローダ
             */
            function IMGLoader(list, callback){
                var img   = [];
                var count = 0;

                for( i=0; i < list.length; i++){
                    img[i] = new Image();
                    img[i].src = list[i];
            
                    img[i].onload = function() {
                        count++;
                        if(count === list.length){
                            callback(img);
                        }
                    };
                }
            }

        </script>
    </body>
</html>